---
title: Protocol v1
redirect_from:
  - /protocol/v1.html
---

# Protocol v1 (UI ↔ Engine)

This protocol defines a stable interaction boundary between UI and Engine: **Op → Engine → EventMsg**. The goal is to decouple entry points from the engine so the engine can evolve without refactoring UIs.

## Design principles

- **Stable contract**: minimize protocol churn so UI and engine can iterate independently.
- **Extensible**: new UIs, connectors, or model providers do not require engine refactors.
- **Dual-queue model**: SubmissionQueue (SQ) and EventQueue (EQ) support async processing and replay.

## Core concepts

### Session

Configuration context for a session (profile/provider/connector).

### Task

One user input becomes a Task, which may include multiple Turns.

### Turn

One tool/model-driven execution loop, ending with TurnComplete and TaskComplete.

## Queue model

```
UI                 Engine
 |  Op  -> SQ  ->  [handle Op]  ->  EQ  -> EventMsg |
```

UI only sends Ops and consumes EventMsg.

## Ops

- `ConfigureSession`: set profile/config/provider/connector
- `UserInput`: submit input (email JSON / raw email / replay)
- `Interrupt`: interrupt a task (reserved)
- `Approval`: approval response (reserved)

## EventMsg

- `SessionConfigured`: session created
- `AgentMessage`: status/info messages
- `ApprovalRequest`: UI approval needed
- `TurnComplete`: one turn finished (with bookmark)
- `TaskComplete`: task finished (with artifacts)
- `Error`: error event

## Artifacts

Current engine artifacts:

- `detection_result`: structured result (verdict / risk_score / explanation / evidence)
- `report_md`: Markdown report

## Versioning

Protocol v1 is forward compatible. Fields are only added, not removed. Compatibility parsing lives in `protocol/serde.py`.
